---
title: Centos7.6mini版-网络配置
date: 2019-03-14 19:17:57
tags:
  linux
coments: true
---



踩了一天的坑终于centos7.6无法访问外网的原因了

踩坑两个文件

```shell
/etc/sysconofig/network
/etc/sysconofig/network
```

<!--more-->



## 查看ip

```shell
ip addr
```



## 默认网卡信息：

进入配置文件

```shell
cd /etc/sysconfig/network-scripts/
```

找到配置文件ifcfg-*** ,这样的文件有两个，另一个是ifcfg-lo(里面的配置的是centos系统自身的网络配置信息，不用管他)。

我的是这个

```shell
vi ifcfg-ens33 
```

然后配置里面信息（默认配置信息如下）

```
TYPE=Ethernet                # 网卡类型：为以太网
PROXY_METHOD=none            # 代理方式：关闭状态
BROWSER_ONLY=no                # 只是浏览器：否
BOOTPROTO=dhcp                # 网卡的引导协议：DHCP[中文名称: 动态主机配置协议]
DEFROUTE=yes                # 默认路由：是, 不明白的可以百度关键词 `默认路由` 
IPV4_FAILURE_FATAL=no        # 是不开启IPV4致命错误检测：否
IPV6INIT=yes                # IPV6是否自动初始化: 是[不会有任何影响, 现在还没用到IPV6]
IPV6_AUTOCONF=yes            # IPV6是否自动配置：是[不会有任何影响, 现在还没用到IPV6]
IPV6_DEFROUTE=yes            # IPV6是否可以为默认路由：是[不会有任何影响, 现在还没用到IPV6]
IPV6_FAILURE_FATAL=no        # 是不开启IPV6致命错误检测：否
IPV6_ADDR_GEN_MODE=stable-privacy            # IPV6地址生成模型：stable-privacy [这只一种生成IPV6的策略]
NAME=ens33                    # 网卡物理设备名称
UUID=f47bde51-fa78-4f79-b68f-d5dd90cfc698    # 通用唯一识别码, 每一个网卡都会有, 不能重复, 否两台linux只有一台网卡可用
DEVICE=ens33                    # 网卡设备名称, 必须和 `NAME` 值一样
ONBOOT=no                        # 是否开机启动， 要想网卡开机就启动或通过 `systemctl restart network`控制网卡,必须设置为 `yes` 
```

这里有两个个比较重要的概念：

BOOTPROTO	IP分配方式 ；dhcp为系统分配，static 静态IP

ONBOOT		设置开机自启



## 配置网卡为静态IP



设置网卡引导协议为静态

```shell
BOOTPROTO=static
```

设置开机自启

```shell
ONBOOT=yes
```

配置IP/子网掩码/网关/DNS

```shell
IPADDR=192.168.140.4		#网段内的任意都行
PREFIX=24					#设置子网掩码，也可以用NETMASK=24	24代表255.255.255.0
GATEWAT=192.168.140.2		#设置网关	
DNS1=211.67.140.2			#设置DNS
DNS2=114.114.114.114
DNS3=8.8.8.8
```

注：这里都可以变量后面都可以加上数字，和DNS一样，表示有多个DNS解析，但是优先第一个



## 获取IP/子网掩码/网关/DNS

![](https://i.loli.net/2019/03/14/5c8a3df14546c.jpg)



![](https://i.loli.net/2019/03/14/5c8a42cc2fc01.png)

记住框框里的内容

子网ip就是你的那个网段，可以分配192.168.140.0——192.168.140.255 但是一般不会用0 1 2 255

0是代表哪个网段 1或者2代表着网关，就是虚拟机连接宿主机的那个ip 255是广播ip不能用，其他的你可以随便用于你的系统ip

这样我们就获得centos ip 、子网掩码

还记得我们框框里的东西：那个网管就是我们在网络配置里的网关。

接下来我们获取dns， dns就是对域名的解析，不懂自行baidu。

常用的dns：公用干净的114.114.114.114国内通用，8.8.8.8是google的；这里我添加了宿机局域网的dns（不知道是那根筋错了，加上去了）。

这样我们要的东西就齐了



## 重启服务

有两种命令：

```shell
service network restart
```

```shell
systemctl restart network
```

两种命令都可以



然后我们ping 8.8.8.8 或者www.baidu.com都可以，看能不能ping外网

## 我就是在这里栽的，

无法ping外网 如果出现无法ping外网

首先查看

```shell
cat /etc/resolv.conf
```

看dns配置信息加载进去没有，没有自己手动添加

```shell
nameserver 114.114.114.114
nameserver 8.8.8.8
```

然后查看

```shell
cat /etc/sysconofig/network
```

看网关信息添加进去没有，没有手动添加

```shell
GATEWAY=192.168.140.2
```

然后就可以愉快的访问外网了，哭兮兮，整了一天，惨不忍睹





## 扩展知识：

| 选择网络连接属性                                      | 意义                                                         |
| ----------------------------------------------------- | ------------------------------------------------------------ |
| Use bridged networking（使用桥接网络）                | 使用（连接）VMnet0虚拟交换机，此时虚拟机相当于网络上的一台**独立计算机，与主机一样**，拥有一个独立的IP地址，效果如图2-56所示 |
| Use network address translation（NAT）（使用NAT网络） | 使用（连接）VMnet8虚拟交换机，此时**虚拟机可以通过主机单向访问网络上的其他工作站（包括Internet网络），其他工作站不能访问虚拟机** |
| Use Host-Only networking（使用主机网络）              | 使用（连接）VMnet1虚拟交换机，此时**虚拟机只能与虚拟机、主机互连，与网络上的其他工作站不能访问** |
| Do not use a network connection                       | 虚拟机中没有网卡，相当于“单机”使用                           |



### 桥接：

 桥接网络是指本地物理网卡和虚拟网卡通过VMnet0虚拟交换机进行桥接，物理网卡和虚拟网卡在拓扑图上处于同等地位，那么物理网卡和虚拟网卡就相当于处于同一个网段，虚拟交换机就相当于一台现实网络中的交换机,所以两个网卡的IP地址也要设置为同一网段。

   所以当我们要在局域网使用虚拟机，对局域网其他pc提供服务时，例如提供ftp，提供ssh，提供http服务，那么就要选择桥接模式。

   例如大学宿舍里有一个路由器，宿舍里四个人连接这个路由器，路由器的wanip就不理会了，这个ip是动态获取的，而lanip默认是192.168.1.1,子网掩码是255.255.255.0。而其他四个人是自动获取ip，假设四个人的ip是:

   A:192.168.1.100/255.255.255.0,  B:192.168.1.101/255.255.255.0,  C:192.168.1.102/255.255.255.0,  D:192.168.1.103/255.255.255.0

   那么虚拟机的ip可以设置的ip地址是192.168.1.2-192.168.1.99,192.168.1.104-192.168.1.254(网络地址全0和全1的除外，再除去ABCD四个人的ip地址)

  那么虚拟机的ip地址可以设置为192.168.1.98/255.255.255.0,设置了这个ip地址，ABCD这四个人就可以通过192.168.1.98访问虚拟机了，如果虚拟机需要上外网，那么还需要配置虚拟机的路由地址，就是192.168.1.1了，这样，虚拟机就可以上外网了，但是，上网我们一般是通过域名去访问外网的，所以我们还需要为虚拟机配置一个dns服务器，我们可以简单点，把dns服务器地址配置为google的dns服务器:8.8.8.8,到此，虚拟机就可以上网了



### NAT

AT模式中，就是让虚拟机借助NAT(**网络地址转换**)功能，**通过宿主机器所在的网络来访问公网**。

   NAT模式中，虚拟机的网卡和物理网卡的网络，不在同一个网络，虚拟机的网卡，是在vmware提供的一个虚拟网络。

   NAT和桥接的比较:

   (1) NAT模式和桥接模式虚拟机都可以上外网。

   (2) 由于NAT的网络在vmware提供的一个虚拟网络里，所以局域网其他主机是无法访问虚拟机的，而宿主机可以访问虚拟机，虚拟机可以访问局域网的所有主机，因为真实的局域网相对于NAT的虚拟网络，就是NAT的虚拟网络的外网，不懂的人可以查查NAT的相关知识。

   (3) 桥接模式下，多个虚拟机之间可以互相访问；NAT模式下，多个虚拟机之间也可以相互访问。

   如果你建一个虚拟机，只是给自己用，不需要给局域网其他人用，那么可以选择NAT，毕竟NAT模式下的虚拟系统的TCP/IP配置信息是由VMnet8(NAT)虚拟网络的DHCP服务器提供的，只要虚拟机的网路配置是DHCP，那么你不需要进行任何其他的配置，只需要宿主机器能访问互联网即可，就可以让虚拟机联网了。

  例如你想建多个虚拟机集群，作为测试使用，而宿主机可能是一个笔记本，ip不固定。这种应用场景，我们需要采用nat模式了，但是我们要考虑一个问题，虚拟机之间是需要互访的，默认采用dhcp，虚拟机的ip每次重启，ip都是不固定的，所以我们需要手工设置虚拟机的ip地址。

  但是我们对虚拟机网卡所在的虚拟网络的信息还一无所知，例如虚拟机网络的路由地址，子网掩码，所以我们需要先查下nat虚拟网络的信息。

  使用vmware,在Edit->Virtual Network Editor中配置好虚拟网络信息后看到下图所示，注意VMnet8，VMnet8相当于是本机的一个路由，虚拟机设置NAT后就通过这个路由进行上网的，可以查看其网络地址，路由地址，子网掩码。

  选择VMnet8->NAT设置,可以看到子网ip显示为192.168.233.0，子网掩码是255.255.255.0，那路由地址呢，其实就是网关IP了，都是同个东西，这里是192.168.233.2。

  接下来就好办了，在对应的虚拟机设置好ip，子网掩码，路由地址就可以上外网了，至于dns可以设置为8.8.8.8.



### Host-Only

在Host-Only模式下，虚拟网络是一个全封闭的网络，它唯一能够访问的就是主机。其实Host-Only网络和NAT网络很相似，不同的地方就是Host-Only网络没有NAT服务，所以虚拟网络不能连接到Internet。主机和虚拟机之间的通信是通过VMware Network Adepter VMnet1虚拟网卡来实现的。

　　Host-Only的宗旨就是建立一个与外界隔绝的内部网络，来提高内网的安全性。这个功能或许对普通用户来说没有多大意义，但大型服务商会常常利用这个功能。如果你想为VMnet1网段提供路由功能，那就需要使用RRAS，而不能使用XP或2000的ICS，因为ICS会把内网的IP地址改为192.168.0.1，但虚拟机是不会给VMnet1虚拟网卡分配这个地址的，那么主机和虚拟机之间就不能通信了。







参考链接：

写的不好，优先参考这个链接https://segmentfault.com/a/1190000011954814

http://www.cnblogs.com/ggjucheng/archive/2012/08/19/2646007.html



